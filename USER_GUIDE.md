# Article Stock Bot ユーザーガイド

## Article Stock Botとは

Article Stock Botは、Discordに投稿した記事URLを自動的に整理・保存してくれるBotです。移動中やSNSで見つけた気になる記事を、後から「消化しやすい状態」で読み返すことができます。

### 主な特徴

- **簡単保存**: DiscordにURLを投稿するだけで自動的に記事情報を取得
- **AI要約とタグ付け**: Gemini AIが記事の内容に合わせて自動的にタグと要約を生成
- **Obsidian連携**: Markdown形式でObsidian Vaultに保存され、検索や整理が簡単
- **コメント追記**: 後から感想や考察を追加可能
- **24時間稼働**: いつでも記事を保存できる

---

## 何ができるの？

### 1. 記事URLの保存

Web記事のURLを投稿すると、以下の情報が自動的に取得・保存されます：

- 記事タイトル
- 記事の概要（OGP情報）
- AIが生成した3〜5個のタグ
- AIによる要約補足
- 投稿日時

### 2. メモの保存

URLなしでテキストを投稿すると、メモとして保存されます。ちょっとしたアイデアやメモを残したい時に便利です。

### 3. コメントの追記

保存した記事に対して、後から感想や考察を追加できます。Botの返信メッセージのスレッド内にコメントを投稿するだけでOKです。

---

## 使い方

### 記事を保存する

1. **Discordの監視対象チャンネルに記事URLを投稿**

```
https://example.com/interesting-article
```

または、URLと一緒にコメントも投稿できます：

```
https://example.com/interesting-article
これは後で読みたい記事！
```

2. **Botの反応を確認**

- 👁️（目の絵文字）: Botがメッセージを受信した証拠（1秒以内）
- 処理が完了すると、Botがリプライで結果を通知
- ✅（チェックマーク）: 保存が成功した証拠

3. **成功通知の内容**

Botの返信メッセージには以下の情報が含まれます：

- 記事タイトル
- 生成されたタグ
- 保存されたファイル名

**成功通知の例：**
```
✅ 記事を保存しました！

タイトル: Discord BotでAI要約機能を実装する方法
タグ: [Python, Discord Bot, AI要約, 技術記事]
ファイル名: 2025-12-04_Discord BotでAI要約機能を実装する方法.md
```

### コメントを追記する

1. **Botの返信メッセージのスレッドを開く**

保存した記事に対するBotの返信メッセージには、スレッド機能でコメントを追加できます。

2. **スレッド内にコメントを投稿**

```
実装してみた。エラーハンドリングが参考になった。
```

3. **Botがチェックマーク（✅）でリアクション**

コメントが正常に追記されると、Botがチェックマークのリアクションを追加します。

### メモを保存する

URLを含まないテキストを投稿すると、メモとして保存されます：

```
明日のミーティングで〇〇について話す
```

---

## Botの反応について

### リアクション

| 絵文字 | 意味 | タイミング |
|--------|------|------------|
| 👁️ | メッセージを受信しました | 投稿後1秒以内 |
| ✅ | 処理が成功しました | 記事保存完了後、またはコメント追記完了後 |

### 通知メッセージ

#### 成功時

```
✅ 記事を保存しました！

タイトル: 〇〇〇
タグ: [タグ1, タグ2, タグ3]
ファイル名: 2025-12-04_〇〇〇.md
```

#### 警告時（OGP取得に失敗したが保存は継続）

```
⚠️ 記事情報の取得に一部失敗しましたが、URLとコメントを保存しました。

ファイル名: 2025-12-04_無題の記事.md
```

#### エラー時

```
❌ 記事の保存に失敗しました。

エラー内容: 〇〇〇
```

---

## 保存される記事の形式

記事は以下のMarkdown形式でObsidian Vaultに保存されます：

### ファイル名

```
YYYY-MM-DD_記事タイトル.md
```

例：`2025-12-04_Discord BotでAI要約機能を実装する方法.md`

### ファイルの内容

```markdown
---
tags: [Python, Discord Bot, AI要約, 技術記事]
url: https://example.com/article-about-discord-bot
created: 2025-12-04
---

# Discord BotでAI要約機能を実装する方法

## 概要

Discord.pyとGemini APIを組み合わせることで、記事URLを投稿するだけで自動的に要約とタグ付けを行うBotを作成できます。

Geminiによる要約補足: Discord Botの基本的な実装方法から、Gemini APIの統合、エラーハンドリングまでを網羅した実践的なガイド。

## コメント

- 2025-12-04: 電車で見つけた記事。後で実装してみる。
- 2025-12-05: 実装完了。エラーハンドリングが参考になった。
```

### 各セクションの説明

- **YAMLフロントマター**: Obsidianでタグ検索や絞り込みに使用できるメタデータ
- **タイトル（#）**: 記事のタイトル
- **概要（##）**: 記事の概要とAIによる要約補足
- **コメント（##）**: 投稿時のコメントや、後から追加したコメントが日付付きで記録される

---

## よくある質問（FAQ）

### Q1. 複数のURLを一度に投稿できますか？

A1. **できません。** 複数のURLが含まれるメッセージの場合、最初のURLのみが記事として処理され、残りのURLは初回コメントとして扱われます。

**例：**
```
https://example.com/article1
https://example.com/article2
```

↓ この場合

- `https://example.com/article1` が記事URLとして処理される
- `https://example.com/article2` はコメントとして保存される

### Q2. 記事情報の取得に失敗した場合はどうなりますか？

A2. **フォールバック処理が実行されます。**

- OGP情報が取得できない場合: ページの`<title>`タグや`<meta name="description">`を使用
- それでも失敗した場合: タイトルを「無題の記事」として保存
- AIタグ付けに失敗した場合: デフォルトタグ（「未分類」「要確認」）を適用

処理は継続され、URLとコメントは必ず保存されます。

### Q3. どのくらいの時間で保存が完了しますか？

A3. **通常30秒以内**に処理が完了し、成功通知が届きます。

- 受信確認（👁️リアクション）: 1秒以内
- OGP取得: 最大10秒
- AI要約生成: 最大30秒
- GitHub保存: 通常3秒以内

### Q4. 保存された記事をObsidianで確認するには？

A4. Obsidian VaultとしてGitHubリポジトリを同期している場合、自動的に反映されます。

- ファイル保存場所: `vault/articles/`ディレクトリ
- Obsidianでタグ検索すれば、関連記事を簡単に見つけられます

### Q5. Botが反応しない場合は？

A5. 以下を確認してください：

1. **正しいチャンネルに投稿していますか？** → Botは監視対象チャンネルのみ反応します
2. **Botがオンラインですか？** → Discordのメンバーリストでオンライン状態を確認
3. **URLの形式は正しいですか？** → `http://` または `https://` で始まるURLのみ認識されます
4. **他のBotや自分自身のメッセージではないですか？** → Botの投稿やBot同士の会話は処理対象外です

### Q6. プライベートな記事やログインが必要な記事も保存できますか？

A6. **OGP情報が公開されていれば可能です。** ただし、以下の場合は情報取得に失敗する可能性があります：

- ログインが必要なページ（ペイウォール記事など）
- robots.txtで制限されているページ
- User-Agent制限があるページ

これらの場合でも、URLとコメントは保存され、タイトルは「無題の記事」として記録されます。

### Q7. 間違えて投稿した記事を削除できますか？

A7. **Botに削除機能はありません。** GitHubリポジトリまたはObsidian Vault内で手動で該当ファイルを削除してください。

ファイル名は `YYYY-MM-DD_記事タイトル.md` の形式なので、投稿日時から特定できます。

### Q8. タグは後から変更できますか？

A8. **できます。** 保存されたMarkdownファイルのYAMLフロントマター部分を直接編集してください。

```markdown
---
tags: [元のタグ1, 元のタグ2, 元のタグ3]  # ← ここを編集
url: https://example.com/article
created: 2025-12-04
---
```

---

## トラブルシューティング

### 記事の保存に失敗する

**考えられる原因：**

1. **URLが無効** → `http://` または `https://` で始まる正しいURLを投稿してください
2. **対象サイトがタイムアウト** → OGP取得は10秒でタイムアウトします。サイトの応答が遅い場合は失敗することがあります
3. **HTMLサイズが10MB超** → 大きすぎるページは処理できません
4. **ネットワークエラー** → Botのネットワーク接続を確認してください

**対処法：**

- エラーメッセージの内容を確認し、URLが正しいか確認
- しばらく待ってから再度投稿してみる
- 管理者にログを確認してもらう

### コメント追記に失敗する

**考えられる原因：**

1. **スレッドの親メッセージが見つからない** → Botの返信メッセージのスレッド内でコメントしてください
2. **該当する記事ファイルが削除されている** → GitHubリポジトリまたはVault内でファイルが削除された可能性があります

**対処法：**

- 正しいスレッド内でコメントしているか確認
- エラーメッセージが表示された場合は内容を確認

### GitHubへの同期が失敗する

**考えられる原因：**

1. **GitHubのアクセストークンが無効** → 管理者に確認してもらってください
2. **ネットワークエラー** → Botは最大3回まで自動的にリトライします

**対処法：**

- Botは自動的にリトライを実行します
- 3回失敗した場合でも、ローカルにはファイルが保存されています
- 管理者にログを確認してもらい、手動でプッシュしてもらう

---

## まとめ

Article Stock Botは、記事の保存と整理を自動化し、後から振り返りやすくするための便利なツールです。

- ✅ URLを投稿するだけで自動保存
- ✅ AIが自動的にタグ付けと要約を生成
- ✅ Obsidian Vaultに整理された形で保存
- ✅ 後からコメントを追加可能

何か問題が発生した場合は、管理者に問い合わせるか、ログファイル（`logs/article_bot.log`）を確認してください。

---

**バージョン**: 1.0
**最終更新**: 2025-12-05
